#      .
#     / V\
#   / `  /
#  <<   |    Default values for matrix-appservice-irc Helm chart.
#  /    |    You should look at the values examples for what to actually apply.
#

nameOverride: ""
fullnameOverride: ""

host: ""

image:
  repository: matrixdotorg/matrix-appservice-irc
  tag: "release-4.0.0"
  pullPolicy: IfNotPresent

replicas: 1

bridge:
  resources: {}

pool:
  enabled: true
  replicas: 1
  image:
    repository: matrixdotorg/matrix-appservice-irc
    tag: "release-4.0.0"
    pullPolicy: IfNotPresent
  metricsPort: 7002
  metricsHost: 0.0.0.0
  loggingLevel: info
  resources: {}

waitForRedis:
  # Kubernetes init-container gate to avoid startup race with Redis.
  # This is only used when redis.enabled=true.
  enabled: true
  image:
    repository: busybox
    tag: "1.36"
    pullPolicy: IfNotPresent
  port: 6379
  sleepSeconds: 2

service:
  appservicePort: 8090
  mediaProxyPort: 11111

podSecurityContext:
  enabled: true
  seccompProfile:
    type: RuntimeDefault

securityContext:
  enabled: true
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

homeserver:
  url: http://ess-synapse.ess.svc.cluster.local:8008
  # Required: Matrix domain used by homeserver config and registration regex entries.
  domain: ""

mediaProxy:
  # Path in the container where the media proxy signing key file is mounted.
  signingKeyPath: /data/media-proxy-signing-key.jwk
  # Inline signing key file content (JWK JSON). If empty, sourced from mediaProxy.existingSecret when set; otherwise auto-generated when mediaProxy.autoGenerate=true.
  signingKey: ""
  # Secret data key used for the signing key file.
  signingKeySecretKey: media-proxy-signing-key.jwk
  # Existing Secret containing key mediaProxy.signingKeySecretKey. When set, no chart-managed signing key Secret is created.
  existingSecret: ""
  managedSecret:
    # Create a chart-managed signing key Secret when existingSecret is not set.
    enabled: true
    # Optional override for the managed Secret name.
    name: ""
  # Auto-generate missing signing key only when using a chart-managed Secret.
  autoGenerate: true
  ttlSeconds: 3600
  bindPort: 11111
  publicUrl: ""

ircClients:
  mode: pool

connectionPool:
  persistConnectionsOnShutdown: true

config:
  # Raw bridge config YAML merged into generated config.yaml.
  # If this overlaps with Helm-managed keys, template rendering fails.
  extra: ""

database:
  engine: postgres
  name: matrix_irc
  user: matrix_irc
  password: matrix_irc_password
  # Optional override. Required when postgres.enabled is false.
  connectionString: ""

registration:
  id: irc
  senderLocalpart: appservice-irc
  rateLimited: false
  # If empty, sourced from registration.existingSecret when set; otherwise auto-generated when registration.autoGenerate=true.
  asToken: ""
  hsToken: ""
  # Existing Secret containing keys `asToken` and `hsToken`. When set, no chart-managed token Secret is created.
  existingSecret: ""
  managedSecret:
    # Create a chart-managed token Secret when existingSecret is not set.
    enabled: true
    # Optional override for the managed Secret name.
    name: ""
  # Auto-generate missing tokens only when using a chart-managed Secret.
  autoGenerate: true
  protocols:
    - irc
  # Optional override. Defaults to bridge service URL in release namespace.
  serviceUrl: ""
  # Optional namespace for an additional Synapse registration ConfigMap copy.
  # A cross-namespace copy is created only when this is non-empty and different from the release namespace.
  synapseNamespace: ""
  # Leave empty to derive from release name, e.g. "<release>-matrix-appservice-irc-registration".
  synapseConfigMapName: ""

postgres:
  enabled: true
  image:
    repository: postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent
  service:
    port: 5432
  persistence:
    enabled: true
    accessMode: ReadWriteOnce
    size: 10Gi
    storageClassName: ""
  podSecurityContext:
    enabled: true
    seccompProfile:
      type: RuntimeDefault
  securityContext:
    enabled: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
  resources: {}

redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent
  args:
    - redis-server
    - --appendonly
    - "yes"
  # Optional override. Required when redis.enabled is false.
  url: ""
  service:
    port: 6379
  persistence:
    enabled: true
    accessMode: ReadWriteOnce
    size: 5Gi
    storageClassName: ""
  podSecurityContext:
    enabled: true
    seccompProfile:
      type: RuntimeDefault
  securityContext:
    enabled: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL
  resources: {}

ingress:
  enabled: true
  # Leave empty to derive from release name, e.g. "<release>-matrix-appservice-irc-media-proxy".
  name: ""
  className: traefik
  path: /
  pathType: Prefix
  clusterIssuer: letsencrypt-prod
  tls:
    enabled: true
    secretName: matrix-appservice-irc-media-proxy-tls
